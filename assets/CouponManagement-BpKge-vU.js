import{a as F,d as B,u as P,o as L,b as N,r as y,w as Y,c as V,e as v,f as e,t as h,h as C,v as D,i as z,k as G,l as A,p as f,q as U,F as S,m as j,n as R,g as I}from"./index-DczOELwp.js";import{M as q,_ as H}from"./DeleteModal.vue_vue_type_script_setup_true_lang-htmz3XWu.js";const O="https://ec-course-api.hexschool.io",w="typescript",k=F.create({baseURL:O});k.interceptors.request.use(n=>{const i=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return i&&(n.headers.Authorization=i),n},n=>Promise.reject(n));k.interceptors.response.use(n=>Promise.resolve(n),n=>Promise.reject(n.response.data));const J=n=>k.get(`/v2/api/${w}/admin/coupons`,{params:n}),K=n=>k.post(`/v2/api/${w}/admin/coupon`,{data:n}),Q=n=>{const{data:i,id:p}=n;return k.put(`/v2/api/${w}/admin/coupon/${p}`,{data:i})},W=n=>k.delete(`/v2/api/${w}/admin/coupon/${n}`),X={class:"modal-dialog modal-dialog-centered"},Z={class:"modal-content rounded-lg"},ee={class:"modal-header"},te={class:"modal-title",id:"couponModalLabel"},oe={class:"modal-body"},ne={class:"mb-3"},ae={class:"mb-3"},se={class:"mb-3"},le={class:"mb-3"},de={class:"mb-3 d-flex align-items-center"},ie={class:"form-check form-switch"},re={class:"modal-footer"},ce=["disabled"],ue={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},pe=B({__name:"CouponModal",props:{coupon:{}},emits:["get-coupons"],setup(n,{expose:i,emit:p}){const r=n,_=p,c=P("modalRef");let u=null;L(()=>{c.value&&(u=new q(c.value))}),N(()=>{u&&u.dispose()});const m=()=>{u&&u.show()},b=()=>{u&&u.hide()},s=y({id:"",title:"",is_enabled:0,percent:0,code:"",due_date:""});Y(()=>r.coupon,o=>{if(o.id){const t=new Date(o.due_date*1e3),l=t.getFullYear(),M=String(t.getMonth()+1).padStart(2,"0"),$=String(t.getDate()).padStart(2,"0");s.value={...o,due_date:`${l}-${M}-${$}`}}else{const t=new Date,l=t.getFullYear(),M=String(t.getMonth()+1).padStart(2,"0"),$=String(t.getDate()).padStart(2,"0");s.value={id:"",title:"",is_enabled:0,percent:0,code:"",due_date:`${l}-${M}-${$}`}}},{immediate:!0,deep:!0});const x=V(()=>!!r.coupon.id),g=y(!1),d=V(()=>x.value?"編輯優惠券":"新增優惠券"),a=async()=>{g.value=!0;const o=new Date(s.value.due_date),t=Math.floor(o.getTime()/1e3),{id:l,due_date:M,...$}=s.value,T={...$,due_date:t};try{x.value&&l?await Q({id:l,data:T}):await K(T),b(),_("get-coupons")}catch(E){console.error("error",E),alert("新增/編輯優惠券失敗")}finally{g.value=!1}};return i({openModal:m,closeModal:b}),(o,t)=>(f(),v("div",{ref_key:"modalRef",ref:c,class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",X,[e("div",Z,[e("div",ee,[e("h5",te,h(d.value),1),e("button",{onClick:b,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]),e("div",oe,[e("form",null,[e("div",ne,[t[5]||(t[5]=e("label",{for:"couponTitle",class:"form-label"},"名稱",-1)),C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.title=l),type:"text",class:"form-control rounded-lg",id:"couponTitle",placeholder:"請輸入名稱"},null,512),[[D,s.value.title]])]),e("div",ae,[t[6]||(t[6]=e("label",{for:"couponCode",class:"form-label"},"折扣碼",-1)),C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.code=l),type:"text",class:"form-control rounded-lg",id:"couponCode",placeholder:"請輸入折扣碼"},null,512),[[D,s.value.code]])]),e("div",se,[t[7]||(t[7]=e("label",{for:"couponDate",class:"form-label"},"截止日",-1)),C(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.due_date=l),type:"date",class:"form-control rounded-lg",id:"couponDate"},null,512),[[D,s.value.due_date]])]),e("div",le,[t[8]||(t[8]=e("label",{for:"couponPercent",class:"form-label"},"折扣百分比",-1)),C(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.percent=l),type:"number",class:"form-control rounded-lg",id:"couponPercent",placeholder:"請輸入折扣百分比"},null,512),[[D,s.value.percent,void 0,{number:!0}]])]),e("div",de,[t[9]||(t[9]=e("label",{class:"form-label me-3 mb-0"},"是否啟用",-1)),e("div",ie,[C(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.is_enabled=l),class:"form-check-input",type:"checkbox",id:"couponEnabled","true-value":1,"false-value":0},null,512),[[z,s.value.is_enabled]])])])])]),e("div",re,[e("button",{onClick:b,type:"button",class:"btn btn-outline-secondary rounded-lg"}," 取消 "),e("button",{onClick:a,disabled:g.value,type:"button",class:"btn btn-dark rounded-lg"},[g.value?(f(),v("span",ue)):G("",!0),t[10]||(t[10]=A(" 儲存 ",-1))],8,ce)])])])],512))}}),me=n=>{const i=new Date(n*1e3),p=m=>m<10?"0"+m:m,r=i.getFullYear(),_=p(i.getMonth()+1),c=p(i.getDate());return`${r}-${_}-${c}`},be={class:"d-flex justify-content-end align-items-center mb-4"},ve={class:"card shadow-sm rounded-lg flex-grow-1"},fe={class:"card-body p-4"},_e={class:"table-responsive"},ge={class:"table table-hover align-middle"},he={class:"text-center"},ye={class:"form-check form-switch d-flex justify-content-center align-items-center"},ke=["checked"],$e={class:"text-nowrap"},Ce=["onClick"],xe=["onClick"],Me={class:"d-flex justify-content-center mt-4"},De={class:"pagination"},we={class:"page-item"},Se=["disabled"],Re=["onClick","disabled"],Pe={class:"page-item"},Te=["disabled"],je=B({__name:"CouponManagement",setup(n){const i=P("couponModalRef"),p=P("deleteModalRef"),r=y("1"),_=y([]),c=y({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),u=async()=>{try{const d=await J({page:r.value});_.value=d.data.coupons,c.value=d.data.pagination}catch(d){console.log("error",d),alert("取得優惠券列表失敗")}};L(()=>{u()});const m=()=>({id:"",title:"",is_enabled:0,percent:0,code:"",due_date:Date.now()/1e3}),b=y(m()),s=(d=null)=>{d?b.value={...d}:b.value=m(),i.value?.openModal()},x=d=>{p.value?.openModal(()=>g(d))},g=async d=>{try{await W(d)}catch(a){console.log("error",a),alert("刪除優惠券失敗")}finally{u()}};return(d,a)=>(f(),v(S,null,[e("div",be,[e("button",{onClick:a[0]||(a[0]=o=>s(null)),type:"button",class:"btn btn-dark rounded-lg px-4 py-2"},[...a[3]||(a[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),A("新增優惠券 ",-1)])])]),e("div",ve,[e("div",fe,[e("div",_e,[e("table",ge,[a[4]||(a[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"折扣碼"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"截止日"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(f(!0),v(S,null,j(_.value,o=>(f(),v("tr",{key:o.id},[e("td",null,h(o.title),1),e("td",null,h(o.code),1),e("td",null,h(o.percent),1),e("td",null,h(I(me)(o.due_date)),1),e("td",he,[e("div",ye,[e("input",{readonly:"",class:"form-check-input",style:{"pointer-events":"none"},type:"checkbox",id:"flexSwitchCheckDefault1",checked:!!o.is_enabled},null,8,ke)])]),e("td",$e,[e("button",{onClick:t=>s(o),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"}," 編輯 ",8,Ce),e("button",{onClick:t=>x(o.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",8,xe)])]))),128))])])]),e("nav",Me,[e("ul",De,[e("li",we,[e("button",{onClick:a[1]||(a[1]=o=>r.value=String(Number(r.value)-1)),disabled:!c.value?.has_pre,type:"button",class:R(["page-link",{disabled:!c.value?.has_pre}]),"aria-label":"Previous"},[...a[5]||(a[5]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,Se)]),(f(!0),v(S,null,j(c.value?.total_pages,o=>(f(),v("li",{class:"page-item",key:o},[e("button",{onClick:t=>r.value=o.toString(),disabled:r.value===o.toString(),type:"button",class:R(["page-link",{active:r.value===o.toString()}])},h(o),11,Re)]))),128)),e("li",Pe,[e("button",{onClick:a[2]||(a[2]=o=>r.value=String(Number(r.value)+1)),disabled:!c.value?.has_next,class:R(["page-link",{disabled:!c.value?.has_next}]),type:"button","aria-label":"Next"},[...a[6]||(a[6]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,Te)])])])])]),U(pe,{ref_key:"couponModalRef",ref:i,coupon:b.value,onGetCoupons:u},null,8,["coupon"]),U(H,{ref_key:"deleteModalRef",ref:p,title:"刪除優惠券",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{je as default};
